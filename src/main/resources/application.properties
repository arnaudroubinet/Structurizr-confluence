# Quarkus Configuration for Structurizr Confluence Exporter CLI

# Application info
quarkus.application.name=structurizr-confluence
quarkus.application.version=1.0.0

# Logging configuration - simple console format
quarkus.log.level=INFO
quarkus.log.console.enable=true
quarkus.log.console.format=%d{HH:mm:ss} %-5p [%c{1}] %s%e%n
quarkus.log.console.json=false

# Native compilation configuration
quarkus.native.enable-http-url-handler=true
# Enable Quarkus security services set (correct key)
quarkus.native.enable-all-security-services=true
# Workaround flexmark Random in image heap and tune build for low memory

# Frugal native build settings (reduce memory footprint during image build)
# Disable stricter checks to lower memory usage in constrained environments
# Limit native-image heap; adjust up if you have more RAM
quarkus.native.native-image-xmx=${NATIVE_IMAGE_XMX:3g}
# When building in container, cap container resources (comma-separated docker args)
# Increase if available; defaults chosen for typical Dev Container constraints
quarkus.native.container-build=true
quarkus.native.container-runtime-options=${NATIVE_CONTAINER_OPTS:--memory=5g,--cpus=2}
# Lower parallelism to smooth peak memory usage (passed via additional-build-args)
# Also restrict active processors to reduce compilation concurrency
# Enable reports to assist diagnostics if build fails
quarkus.native.enable-reports=true
quarkus.native.additional-build-args=--initialize-at-run-time=com.vladsch.flexmark, --initialize-at-run-time=com.vladsch.flexmark.util.sequence.Escaping, --initialize-at-run-time=org.apache.hc.client5.http.impl.auth.NTLMEngineImpl, --initialize-at-run-time=org.apache.hc.client5.http.impl.auth.NTLMEngine, --parallelism=2, -H:CompilerConfiguration=quick, -J-Djava.util.concurrent.ForkJoinPool.common.parallelism=1, -J-XX:ActiveProcessorCount=2

# REST Client Confluence API
# Base URL of your Confluence Cloud (no trailing slash)
# Example: https://your-domain.atlassian.net
quarkus.rest-client.confluence-api.url=${CONFLUENCE_BASE_URL:http://localhost}

# Credentials for Basic Auth
confluence.username=${CONFLUENCE_USER:}
confluence.token=${CONFLUENCE_TOKEN:}